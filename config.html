<!DOCTYPE html>
<html lang="pt-BR">

<head>
        <meta charset="UTF-8" />
        <title>Flappy — Configuração</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <style>
                :root {
                        --bg: #0b1220;
                        --panel: #0f172a;
                        --ink: #e5e7eb;
                        --muted: #94a3b8;
                        --line: #1f2937;
                        --acc: #22c55e;
                        --btn: #111827;
                        --btnb: #334155;
                        --btnh: #1f2937
                }

                * {
                        box-sizing: border-box
                }

                html,
                body {
                        height: 100%;
                        margin: 0;
                        background: var(--bg);
                        color: var(--ink);
                        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif
                }

                header {
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        gap: 12px;
                        padding: 12px 16px;
                        border-bottom: 1px solid var(--line)
                }

                .title {
                        font-weight: 600;
                        letter-spacing: .2px
                }

                .actions {
                        display: flex;
                        flex-wrap: wrap;
                        gap: 8px;
                        align-items: center
                }

                .btn,
                .link,
                .input {
                        appearance: none;
                        border: 1px solid var(--btnb);
                        background: var(--btn);
                        color: var(--ink);
                        padding: 8px 12px;
                        border-radius: 10px;
                        font-size: 14px
                }

                .btn:hover,
                .link:hover {
                        background: var(--btnh)
                }

                .link {
                        color: var(--acc);
                        text-decoration: none;
                        display: inline-flex;
                        gap: 6px
                }

                .wrap {
                        max-width: 1200px;
                        margin: 18px auto 24px;
                        padding: 0 16px;
                        display: grid;
                        grid-template-columns: 1.1fr .9fr;
                        gap: 16px
                }

                @media (max-width:980px) {
                        .wrap {
                                grid-template-columns: 1fr
                        }
                }

                .panel {
                        background: var(--panel);
                        border: 1px solid var(--line);
                        border-radius: 14px;
                        padding: 14px
                }

                h2 {
                        margin: 8px 0 12px;
                        font-size: 16px
                }

                fieldset.group {
                        border: 1px solid var(--line);
                        border-radius: 12px;
                        padding: 10px;
                        margin: 12px 0
                }

                fieldset.group legend {
                        padding: 0 6px;
                        font-weight: 600
                }

                .row {
                        display: grid;
                        grid-template-columns: 220px 1fr;
                        gap: 10px;
                        align-items: center;
                        margin: 6px 0
                }

                .row input[type="text"],
                .row input[type="number"] {
                        width: 100%;
                        max-width: 360px
                }

                .hint {
                        font-size: 12px;
                        color: var(--muted)
                }

                #jsonPreview {
                        background: #0a0f1d;
                        color: #cbd5e1;
                        border: 1px solid var(--line);
                        border-radius: 12px;
                        padding: 10px;
                        overflow: auto;
                        min-height: 220px;
                        white-space: pre
                }

                #status {
                        min-height: 20px;
                        margin-top: 8px
                }

                #status .ok {
                        color: #86efac
                }

                #status .err {
                        color: #fca5a5
                }

                /* role gate: oculta blocos master para client */
                html[data-role="client"] [data-role-guard="master"] {
                        display: none !important
                }

                html[data-role="client"] .client-readonly {
                        opacity: .7;
                        pointer-events: none
                }

                /* Scores */
                #scoresList {
                        max-height: 420px;
                        overflow: auto;
                        border-top: 1px solid var(--line);
                        margin-top: 8px
                }

                .scoreItem {
                        display: grid;
                        grid-template-columns: 36px 1fr auto;
                        gap: 8px;
                        align-items: center;
                        padding: 8px 4px;
                        border-bottom: 1px dashed var(--line)
                }

                .rank {
                        opacity: .85
                }

                .pts {
                        font-weight: 700
                }

                /* Auth */
                #authView {
                        display: block;
                        max-width: 460px;
                        margin: 40px auto 0
                }

                #authView .card {
                        background: var(--panel);
                        border: 1px solid var(--line);
                        border-radius: 14px;
                        padding: 16px
                }

                #authView .row {
                        grid-template-columns: 120px 1fr
                }
        </style>
</head>

<body>
        <header>
                <div class="title">Flappy — Configuração</div>
                <div class="actions">
                        <span id="whoami" class="hint">Deslogado</span>
                        <button class="btn" id="btnLogout" style="display:none">Sair</button>
                        <input class="input" id="cfgSlug" placeholder="slug (ex: default)" style="width:160px" />
                        <button class="btn" id="loadSupabase">Carregar</button>
                        <button class="btn" id="saveSupabase">Salvar</button>
                        <a class="link" href="./game.html">▶ Abrir jogo</a>
                </div>
        </header>

        <!-- LOGIN: visível por padrão -->
        <div id="authView">
                <div class="card">
                        <h2>Entrar</h2>
                        <div class="row"><label>Email</label><input class="input" id="authEmail" type="email"
                                        placeholder="master@local ou client@local"></div>
                        <div class="row"><label>Senha</label><input class="input" id="authPass" type="password" placeholder="">
                        </div>
                        <div class="row"><span></span>
                                <div style="display:flex;gap:8px">
                                        <button class="btn" id="doSignIn">Entrar</button>
                                </div>
                        </div>
                        <div class="hint" style="margin-top:8px">
                                <div><b>Master:</b> master@local </div>
                                <div><b>Client:</b> client@local </div>
                        </div>
                        <div id="authMsg" class="hint" style="margin-top:8px"></div>
                </div>
                </div>

        <!-- APP -->
        <div class="wrap" id="appView" style="display:none">
                <!-- COLUNA ESQUERDA -->
                <div class="panel">
                        <h2>Parâmetros</h2>

                        <!-- MASTER: Board -->
                        <fieldset class="group" data-role-guard="master">
                                <legend>Board</legend>
                                <div class="row"><label for="board.width">Width</label><input type="number" id="board.width" step="1"></div>
                                <div class="row"><label for="board.height">Height</label><input type="number" id="board.height" step="1"></div>
                                <div class="row"><label for="board.background">Background</label><input type="text" id="board.background"
                                                placeholder="#70c5ce"></div>
                                </fieldset>

                        <!-- MASTER: Bird -->
                        <fieldset class="group" data-role-guard="master">
                                <legend>Bird</legend>
                                <div class="row"><label for="bird.width">Width</label><input type="number" id="bird.width" step="1"></div>
                                <div class="row"><label for="bird.height">Height</label><input type="number" id="bird.height" step="1"></div>
                                <div class="row"><label for="bird.startXPercent">Start X (%)</label><input type="number" id="bird.startXPercent"
                                                step="0.1"></div>
                                <div class="row"><label for="bird.startYPercent">Start Y (%)</label><input type="number" id="bird.startYPercent"
                                                step="0.1"></div>
                                <div class="row"><label for="bird.flapForce">Flap Force</label><input type="number" id="bird.flapForce" step="0.1">
                                </div>
                                <div class="row"><label for="bird.maxFallSpeed">Max Fall Speed</label><input type="number" id="bird.maxFallSpeed"
                                                step="0.1"></div>
                                <div class="row"><label for="bird.hitboxPadding">Hitbox padding (px)</label><input type="number" id="bird.hitboxPadding"
                                                step="1"></div>
                                </fieldset>

                        <!-- MASTER: Tilt -->
                        <fieldset class="group" data-role-guard="master">
                                <legend>Bird Tilt</legend>
                                <div class="row"><label for="bird.tilt.enabled">Tilt habilitado</label><input type="checkbox" id="bird.tilt.enabled" />
                                </div>
                                <div class="row"><label for="bird.tilt.upDeg">Up (deg)</label><input type="number" id="bird.tilt.upDeg" step="1"></div>
                                <div class="row"><label for="bird.tilt.downDeg">Down (deg)</label><input type="number" id="bird.tilt.downDeg" step="1">
                                </div>
                                <div class="row"><label for="bird.tilt.responsiveness">Responsiveness</label><input type="number"
                                                id="bird.tilt.responsiveness" step="0.01"></div>
                                <div class="row"><label for="bird.tilt.velForMaxUp">Vel p/ Up máx</label><input type="number" id="bird.tilt.velForMaxUp"
                                                step="0.1"></div>
                                <div class="row"><label for="bird.tilt.velForMaxDown">Vel p/ Down máx</label><input type="number"
                                                id="bird.tilt.velForMaxDown" step="0.1"></div>
                                <div class="row"><label for="bird.tilt.snapOnFlap">Snap on flap</label><input type="checkbox"
                                                id="bird.tilt.snapOnFlap" /></div>
                                <div class="row"><label for="bird.tilt.minDeg">Clamp min (deg)</label><input type="number" id="bird.tilt.minDeg"
                                                step="1"></div>
                                <div class="row"><label for="bird.tilt.maxDeg">Clamp max (deg)</label><input type="number" id="bird.tilt.maxDeg"
                                                step="1"></div>
                                </fieldset>

                        <!-- MASTER: Flap Anim -->
                        <fieldset class="group" data-role-guard="master">
                                <legend>Bird Flap Anim</legend>
                                <div class="row"><label for="bird.flapAnim.enabled">Enabled</label><input type="checkbox" id="bird.flapAnim.enabled">
                                </div>
                                <div class="row"><label for="bird.flapAnim.durationMs">Duration (ms)</label><input type="number"
                                                id="bird.flapAnim.durationMs" step="1"></div>
                                <div class="row"><label for="bird.flapAnim.fps">FPS</label><input type="number" id="bird.flapAnim.fps" step="1"></div>
                                </fieldset>

                        <!-- MASTER: Physics -->
                        <fieldset class="group" data-role-guard="master">
                                <legend>Physics</legend>
                                <div class="row"><label for="physics.gravity">Gravity</label><input type="number" id="physics.gravity" step="0.01">
                                </div>
                        </fieldset>

                        <!-- MASTER: Pipes -->
                        <fieldset class="group" data-role-guard="master">
                                <legend>Pipes</legend>
                                <div class="row"><label for="pipes.width">Width</label><input type="number" id="pipes.width" step="1"></div>
                                <div class="row"><label for="pipes.height">Height</label><input type="number" id="pipes.height" step="1"></div>
                                <div class="row"><label for="pipes.scrollSpeed">Scroll Speed</label><input type="number" id="pipes.scrollSpeed"
                                                step="0.1"></div>
                                <div class="row"><label for="pipes.gapPercent">Gap (%)</label><input type="number" id="pipes.gapPercent" step="0.1">
                                </div>
                                <div class="row"><label for="pipes.randomBasePercent">Random Base (%)</label><input type="number"
                                                id="pipes.randomBasePercent" step="0.1"></div>
                                <div class="row"><label for="pipes.randomRangePercent">Random Range (%)</label><input type="number"
                                                id="pipes.randomRangePercent" step="0.1"></div>
                                <div class="row"><label for="pipes.autoStretchToEdges">Auto-stretch to
                                                edges</label><input type="checkbox" id="pipes.autoStretchToEdges"></div>
                                <div class="row"><label for="pipes.edgeOverflowPx">Edge overflow (px)</label><input type="number"
                                                id="pipes.edgeOverflowPx" step="1"></div>
                                </fieldset>

                        <!-- SEMPRE: Difficulty -->
                        <fieldset class="group" data-scope="difficulty">
                                <legend>Difficulty (Cliente pode editar)</legend>
<!-- Presets (cliente) -->
<div class="row">
        <label for="difficultyPreset">Preset</label>
        <div style="display:flex; gap:8px; align-items:center">
                <select class="input" id="difficultyPreset" style="min-width:160px">
                        <option value="custom">Custom</option>
                        <option value="easy">Fácil</option>
                        <option value="medium" selected>Médio</option>
                        <option value="hard">Difícil</option>
                </select>
                <button class="btn" id="applyPreset" type="button">Aplicar</button>
        </div>
</div>


<div class="row"><label for="difficulty.rampEnabled">Ramp enabled (score)</label><input type="checkbox"
                id="difficulty.rampEnabled"></div>
<div class="row"><label for="difficulty.speedPerScore">+Speed per score</label><input type="number"
                id="difficulty.speedPerScore" step="0.01"></div>
<div class="row"><label for="difficulty.minGapPercent">Min gap (%)</label><input type="number"
                id="difficulty.minGapPercent" step="0.1"></div>
                                <div class="row"><label for="difficulty.gapStepPerScore">-Gap per score
                                                (%)</label><input type="number" id="difficulty.gapStepPerScore" step="0.1"></div>
                                <hr style="border:none;border-top:1px solid var(--line);margin:6px 0">
                                <div class="row"><label for="difficulty.timeRampEnabled">Time ramp enabled</label><input type="checkbox"
                                                id="difficulty.timeRampEnabled"></div>
                                <div class="row"><label for="difficulty.timeStartDelayMs">Time start delay
                                                (ms)</label><input type="number" id="difficulty.timeStartDelayMs" step="1" placeholder="0 = após grace">
                                </div>
                                <div class="row"><label for="difficulty.timeSpeedPerSec">+Speed per second</label><input type="number"
                                                id="difficulty.timeSpeedPerSec" step="0.001"></div>
                                <div class="row"><label for="difficulty.timeMaxExtraSpeed">Max extra speed</label><input type="number"
                                                id="difficulty.timeMaxExtraSpeed" step="0.1"></div>
                                <div class="row"><label for="difficulty.timeGapStepPerSec">-Gap per second
                                                (%)</label><input type="number" id="difficulty.timeGapStepPerSec" step="0.01"></div>

                                <hr style="border:none;border-top:1px solid var(--line);margin:6px 0">
                                <div class="row"><label for="difficulty.stepEveryMs">Step interval (ms)</label>
                                        <input type="number" id="difficulty.stepEveryMs" step="1" placeholder="2000">
                                </div>
                                <div class="row"><label for="difficulty.stepAddPxPerFrame">+Speed por step
                                                (px/frame)</label>
                                        <input type="number" id="difficulty.stepAddPxPerFrame" step="0.01" placeholder="0.30">
                                </div>
                                <div class="row"><label for="difficulty.stepMaxExtraPxPerFrame">Teto extra
                                                (px/frame)</label>
                                        <input type="number" id="difficulty.stepMaxExtraPxPerFrame" step="0.1" placeholder="6">
                                </div>
</fieldset>

<fieldset class="group" data-scope="prizes">
        <legend>Grupos / Prêmios (Cliente pode editar)</legend>

        <div id="prizeGroups" style="display:flex;flex-direction:column;gap:8px"></div>

        <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
                <button class="btn" id="btnAddPrize" type="button">+ Adicionar grupo</button>
                <span class="hint">Regra: faixas <b>[min, max)</b> (max exclusivo). O último
                        grupo aceita max inclusivo.</span>
        </div>
</fieldset>


                        <!-- MASTER: Spawn -->
                        <fieldset class="group" data-role-guard="master">
                                <legend>Spawn</legend>
                                <div class="row"><label for="spawn.intervalMs">Interval (ms)</label><input type="number" id="spawn.intervalMs" step="1">
                                </div>
                        </fieldset>

                        <!-- MASTER: Scoring -->
                        <fieldset class="group" data-role-guard="master">
                                <legend>Scoring</legend>
                                <div class="row"><label for="scoring.pointsPerPipe">Points per pipe</label><input type="number"
                                                id="scoring.pointsPerPipe" step="0.1"></div>
                                </fieldset>

                        <!-- MASTER: UI -->
                        <fieldset class="group" data-role-guard="master">
                                <legend>UI</legend>
                                <div class="row"><label for="ui.font">Font</label><input type="text" id="ui.font"
                                                placeholder="45px sans-serif"></div>
                                <div class="row"><label for="ui.scoreColor">Score color</label><input type="text" id="ui.scoreColor"
                                                placeholder="#ffffff"></div>
                                <div class="row"><label for="ui.gameOverText">GameOver text</label><input type="text" id="ui.gameOverText"
                                                placeholder="GAME OVER"></div>
                                <div class="row"><label for="ui.gameOverFont">GameOver font</label><input type="text" id="ui.gameOverFont"
                                                placeholder="45px sans-serif"></div>
                                <div class="row"><label for="ui.gameOverColor">GameOver color</label><input type="text" id="ui.gameOverColor"
                                                placeholder="#ffffff"></div>
                                </fieldset>

                        <!-- MASTER: Controls -->
                        <fieldset class="group" data-role-guard="master">
                                <legend>Controls</legend>
                                <div class="row"><label for="controls.jump">Jump keys (CSV)</label><input type="text" id="controls.jump"
                                                placeholder="Space, ArrowUp, KeyX"></div>
                                </fieldset>
                                </div>

                <!-- COLUNA DIREITA -->
                <div class="panel">
                        <h2>Painel • Scores (Top 50)</h2>
                        <div id="scoresList">
                                <div class="hint">Carregando…</div>
                        </div>

                        <h2 style="margin-top:22px">Prévia do JSON</h2>
                        <pre id="jsonPreview">{}</pre>
                        <div id="status"></div>
                        <p class="hint">Cliente edita apenas <b>Difficulty</b>. Master edita tudo.</p>
                </div>
        </div>

        <script>document.addEventListener('contextmenu', e => e.preventDefault());</script>
        <script type="module" src="./src/config.js"></script>
</body>

</html>